# ü§ñ Telegram Mini App - –†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ –Ω–∞—Å—Ç—Ä–æ–π–∫–µ

## ‚úÖ –ß—Ç–æ –∏–∑–º–µ–Ω–∏–ª–æ—Å—å

### –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è —á–µ—Ä–µ–∑ Telegram
–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —Ç–µ–ø–µ—Ä—å –∏—Å–ø–æ–ª—å–∑—É–µ—Ç **–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫—É—é –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é —á–µ—Ä–µ–∑ Telegram**:
- ‚ùå **–£–¥–∞–ª–µ–Ω–∞** —Å—Ç—Ä–∞–Ω–∏—Ü–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏/–≤—Ö–æ–¥–∞ —Å email/password
- ‚úÖ **–î–æ–±–∞–≤–ª–µ–Ω–∞** –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è —á–µ—Ä–µ–∑ Telegram ID
- ‚úÖ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É—é—Ç—Å—è –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –∑–∞–ø—É—Å–∫–µ
- ‚úÖ –î–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –±–µ—Ä—É—Ç—Å—è –∏–∑ Telegram (–∏–º—è, username, —è–∑—ã–∫)

### Backend –∏–∑–º–µ–Ω–µ–Ω–∏—è
- ‚úÖ –ù–æ–≤—ã–π endpoint: `POST /api/auth/telegram`
- ‚úÖ –ú–æ–¥–µ–ª—å User –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç `telegram_id`, `username`, `language_code`
- ‚úÖ Email –∏ password —Ç–µ–ø–µ—Ä—å –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã (–¥–ª—è Telegram –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π)

### Frontend –∏–∑–º–µ–Ω–µ–Ω–∏—è
- ‚úÖ –£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω `@telegram-apps/sdk-react`
- ‚úÖ –°–æ–∑–¥–∞–Ω `TelegramAuthContext` –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–µ–π
- ‚úÖ App.tsx –æ–±–µ—Ä–Ω—É—Ç –≤ `SDKProvider` –∏ `TelegramAuthProvider`
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

---

## üöÄ –õ–æ–∫–∞–ª—å–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –ü—Ä–æ–±–ª–µ–º–∞ –ª–æ–∫–∞–ª—å–Ω–æ–π —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏
Telegram Mini App SDK —Ä–∞–±–æ—Ç–∞–µ—Ç **—Ç–æ–ª—å–∫–æ –≤–Ω—É—Ç—Ä–∏ Telegram**. –ü—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏ –≤ –±—Ä–∞—É–∑–µ—Ä–µ –≤—ã —É–≤–∏–¥–∏—Ç–µ –æ—à–∏–±–∫—É:
```
–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –æ—Ç–∫—Ä—ã—Ç–æ –≤ Telegram Mini App
```

### –†–µ—à–µ–Ω–∏–µ –¥–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

#### –í–∞—Ä–∏–∞–Ω—Ç 1: –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ Telegram (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)

1. **–°–æ–∑–¥–∞–π—Ç–µ –±–æ—Ç–∞ —á–µ—Ä–µ–∑ [@BotFather](https://t.me/BotFather):**
   ```
   /newbot
   –ù–∞–∑–≤–∞–Ω–∏–µ: FinTrack Dev Bot
   Username: fintrack_dev_bot
   ```

2. **–ü–æ–ª—É—á–∏—Ç–µ Bot Token** –∏ —Å–æ—Ö—Ä–∞–Ω–∏—Ç–µ –µ–≥–æ

3. **–ù–∞—Å—Ç—Ä–æ–π—Ç–µ Mini App:**
   ```
   /newapp
   –í—ã–±–µ—Ä–∏—Ç–µ –≤–∞—à–µ–≥–æ –±–æ—Ç–∞
   –ù–∞–∑–≤–∞–Ω–∏–µ: FinTrack
   Description: –§–∏–Ω–∞–Ω—Å–æ–≤—ã–π —Ç—Ä–µ–∫–µ—Ä
   URL: https://your-ngrok-url.ngrok.io
   ```

4. **–ó–∞–ø—É—Å—Ç–∏—Ç–µ ngrok –¥–ª—è —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞:**
   ```bash
   ngrok http 3001
   ```

5. **–û–±–Ω–æ–≤–∏—Ç–µ URL Mini App** –≤ BotFather:
   ```
   /myapps
   –í—ã–±–µ—Ä–∏—Ç–µ –≤–∞—à –±–æ—Ç
   Edit Bot ‚Üí Edit Mini App ‚Üí URL
   –í–≤–µ–¥–∏—Ç–µ: https://your-ngrok-url.ngrok.io
   ```

6. **–û—Ç–∫—Ä–æ–π—Ç–µ Mini App –≤ Telegram:**
   - –ù–∞–π–¥–∏—Ç–µ –≤–∞—à–µ–≥–æ –±–æ—Ç–∞
   - –ù–∞–∂–º–∏—Ç–µ Menu ‚Üí –≤–∞—à–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ

#### –í–∞—Ä–∏–∞–Ω—Ç 2: Mock –¥–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–π —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏

–û–±–Ω–æ–≤–∏—Ç–µ `TelegramAuthContext.tsx` –¥–ª—è fallback:

```typescript
// –í —Å–ª—É—á–∞–µ –æ—à–∏–±–∫–∏ - –∏—Å–ø–æ–ª—å–∑—É–µ–º –º–æ–∫–∏ –¥–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–π —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏
if (process.env.NODE_ENV === 'development') {
  const mockUser = {
    id: 123456789,
    first_name: 'Test',
    last_name: 'User',
    username: 'testuser'
  };

  setTelegramUser(mockUser);
  // ... –æ—Å—Ç–∞–ª—å–Ω–∞—è –ª–æ–≥–∏–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
}
```

---

## üì± –°–æ–∑–¥–∞–Ω–∏–µ Telegram Bot

### –®–∞–≥ 1: –°–æ–∑–¥–∞–Ω–∏–µ –±–æ—Ç–∞

1. –û—Ç–∫—Ä–æ–π—Ç–µ [@BotFather](https://t.me/BotFather) –≤ Telegram
2. –û—Ç–ø—Ä–∞–≤—å—Ç–µ `/newbot`
3. –í–≤–µ–¥–∏—Ç–µ –∏–º—è –±–æ—Ç–∞: **FinTrack**
4. –í–≤–µ–¥–∏—Ç–µ username: **fintrack_your_name_bot** (–¥–æ–ª–∂–µ–Ω –∑–∞–∫–∞–Ω—á–∏–≤–∞—Ç—å—Å—è –Ω–∞ `_bot`)
5. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ **Bot Token** (–Ω–∞–ø—Ä–∏–º–µ—Ä: `1234567890:ABCdefGHIjklMNOpqrsTUVwxyz`)

### –®–∞–≥ 2: –°–æ–∑–¥–∞–Ω–∏–µ Mini App

1. –û—Ç–ø—Ä–∞–≤—å—Ç–µ `/newapp` –≤ BotFather
2. –í—ã–±–µ—Ä–∏—Ç–µ –≤–∞—à–µ–≥–æ –±–æ—Ç–∞
3. –í–≤–µ–¥–∏—Ç–µ:
   - **Title:** FinTrack
   - **Description:** –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ª–∏—á–Ω—ã–º–∏ —Ñ–∏–Ω–∞–Ω—Å–∞–º–∏
   - **Photo:** –∑–∞–≥—Ä—É–∑–∏—Ç–µ –∏–∫–æ–Ω–∫—É (512x512px)
   - **GIF Demo:** (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
   - **URL:** –í–∞—à ngrok URL (–Ω–∞–ø—Ä–∏–º–µ—Ä: `https://abcd-1234.ngrok.io`)

### –®–∞–≥ 3: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Backend

–°–æ—Ö—Ä–∞–Ω–∏—Ç–µ Bot Token –≤ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è:

```env
# api/.env
TELEGRAM_BOT_TOKEN=your_bot_token_here
```

–û–±–Ω–æ–≤–∏—Ç–µ `api/app/controllers/api/telegram_auth_controller.rb` –¥–ª—è –≤–∞–ª–∏–¥–∞—Ü–∏–∏:

```ruby
def validate_telegram_data(init_data)
  return true if Rails.env.development? # –î–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–π —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏

  # –í–∞–ª–∏–¥–∞—Ü–∏—è init_data —Å bot token
  bot_token = ENV['TELEGRAM_BOT_TOKEN']
  # ... —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è –≤–∞–ª–∏–¥–∞—Ü–∏–∏ —Ö–µ—à–∞
  true
end
```

---

## üåê –î–µ–ø–ª–æ–π –Ω–∞ Netlify

### 1. –û–±–Ω–æ–≤–∏—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

–í Netlify Dashboard ‚Üí Site settings ‚Üí Environment variables:
```
VITE_API_URL=https://your-api-url.com/api
```

### 2. –î–µ–ø–ª–æ–π—Ç–µ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥

```bash
cd web
npm run build
# Netlify –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–±–µ—Ä–µ—Ç –ø—Ä–∏ git push
```

### 3. –û–±–Ω–æ–≤–∏—Ç–µ URL –≤ BotFather

–ü–æ—Å–ª–µ –¥–µ–ø–ª–æ—è –æ–±–Ω–æ–≤–∏—Ç–µ URL Mini App:
```
/myapps
‚Üí –í—ã–±–µ—Ä–∏—Ç–µ –±–æ—Ç–∞
‚Üí Edit Mini App
‚Üí URL: https://your-netlify-app.netlify.app
```

---

## üîß –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏

### –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç:

1. **–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç Mini App –≤ Telegram**
2. **Frontend –ø–æ–ª—É—á–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ –∏–∑ Telegram WebApp API:**
   ```typescript
   const { user, initData } = retrieveLaunchParams();
   ```
3. **–û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –Ω–∞ backend:**
   ```typescript
   POST /api/auth/telegram
   {
     init_data: "query_id=...",
     user: {
       telegram_id: 123456789,
       first_name: "John",
       last_name: "Doe",
       username: "johndoe"
     }
   }
   ```
4. **Backend –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –∏ —Å–æ–∑–¥–∞–µ—Ç/–Ω–∞—Ö–æ–¥–∏—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è**
5. **–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç JWT —Ç–æ–∫–µ–Ω**
6. **Frontend —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç —Ç–æ–∫–µ–Ω –∏ –∞–≤—Ç–æ—Ä–∏–∑—É–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è**

### –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å:

- ‚úÖ Init data –≤–∞–ª–∏–¥–∏—Ä—É–µ—Ç—Å—è –ø–æ —Ö–µ—à—É —Å bot token
- ‚úÖ JWT —Ç–æ–∫–µ–Ω –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª–µ–Ω 30 –¥–Ω–µ–π
- ‚úÖ –¢–æ–∫–µ–Ω –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è –∫ –∫–∞–∂–¥–æ–º—É –∑–∞–ø—Ä–æ—Å—É
- ‚úÖ –ü—Ä–∏ 401 –æ—à–∏–±–∫–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –¥–µ–∞–≤—Ç–æ—Ä–∏–∑—É–µ—Ç—Å—è

---

## üìã Checklist –ø–µ—Ä–µ–¥ –∑–∞–ø—É—Å–∫–æ–º

- [ ] –°–æ–∑–¥–∞–Ω Telegram Bot —á–µ—Ä–µ–∑ BotFather
- [ ] –°–æ–∑–¥–∞–Ω Mini App —Å URL
- [ ] Bot Token —Å–æ—Ö—Ä–∞–Ω–µ–Ω –≤ .env
- [ ] Backend —Ä–∞–∑–≤–µ—Ä–Ω—É—Ç –∏ –¥–æ—Å—Ç—É–ø–µ–Ω
- [ ] Frontend —Ä–∞–∑–≤–µ—Ä–Ω—É—Ç –Ω–∞ Netlify
- [ ] CORS –Ω–∞—Å—Ç—Ä–æ–µ–Ω –¥–ª—è –≤–∞—à–µ–≥–æ –¥–æ–º–µ–Ω–∞
- [ ] URL Mini App –æ–±–Ω–æ–≤–ª–µ–Ω –≤ BotFather
- [ ] –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–æ –æ—Ç–∫—Ä—ã—Ç–∏–µ –≤ Telegram

---

## üêõ –†–µ—à–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º

### "–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –æ—Ç–∫—Ä—ã—Ç–æ –≤ Telegram"
**–ü—Ä–∏—á–∏–Ω–∞:** –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –æ—Ç–∫—Ä—ã—Ç–æ –≤ –±—Ä–∞—É–∑–µ—Ä–µ, –∞ –Ω–µ –≤ Telegram

**–†–µ—à–µ–Ω–∏–µ:**
1. –û—Ç–∫—Ä–æ–π—Ç–µ Mini App —á–µ—Ä–µ–∑ Telegram –±–æ—Ç–∞
2. –ò–õ–ò –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ mock –¥–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–π —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏

### "Invalid Telegram data"
**–ü—Ä–∏—á–∏–Ω–∞:** Init data –Ω–µ –ø—Ä–æ—à–ª–∞ –≤–∞–ª–∏–¥–∞—Ü–∏—é

**–†–µ—à–µ–Ω–∏–µ:**
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ TELEGRAM_BOT_TOKEN –≤ .env
2. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —Ç–æ–∫–µ–Ω –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π
3. –î–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ –º–æ–∂–Ω–æ –≤—Ä–µ–º–µ–Ω–Ω–æ –æ—Ç–∫–ª—é—á–∏—Ç—å –≤–∞–ª–∏–¥–∞—Ü–∏—é

### "Network Error" –ø—Ä–∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
**–ü—Ä–∏—á–∏–Ω–∞:** Backend –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω –∏–ª–∏ CORS –Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω

**–†–µ—à–µ–Ω–∏–µ:**
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ backend –∑–∞–ø—É—â–µ–Ω
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ CORS –≤ `api/config/initializers/cors.rb`
3. –î–æ–±–∞–≤—å—Ç–µ –≤–∞—à Netlify –¥–æ–º–µ–Ω –≤ origins

### Mini App –Ω–µ –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è –≤ Telegram
**–ü—Ä–∏—á–∏–Ω–∞:** –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π URL –∏–ª–∏ App –Ω–µ –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω

**–†–µ—à–µ–Ω–∏–µ:**
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ URL –≤ BotFather
2. URL –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å HTTPS (–∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ ngrok –∏–ª–∏ Netlify)
3. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ App –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö –±–æ—Ç–∞

---

## üìö –ü–æ–ª–µ–∑–Ω—ã–µ —Å—Å—ã–ª–∫–∏

- [Telegram Mini Apps Documentation](https://core.telegram.org/bots/webapps)
- [BotFather Commands](https://core.telegram.org/bots#botfather)
- [@telegram-apps/sdk-react GitHub](https://github.com/telegram-mini-apps/telegram-apps/tree/master/packages/sdk-react)
- [Validating init_data](https://core.telegram.org/bots/webapps#validating-data-received-via-the-mini-app)

---

## üéØ –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

1. ‚úÖ –°–æ–∑–¥–∞–π—Ç–µ Telegram –±–æ—Ç–∞
2. ‚úÖ –ù–∞—Å—Ç—Ä–æ–π—Ç–µ Mini App
3. ‚úÖ –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä—É–π—Ç–µ –ª–æ–∫–∞–ª—å–Ω–æ —á–µ—Ä–µ–∑ ngrok
4. ‚úÖ –ó–∞–¥–µ–ø–ª–æ–π—Ç–µ –Ω–∞ Netlify
5. ‚úÖ –û–ø—É–±–ª–∏–∫—É–π—Ç–µ Mini App

**–ì–æ—Ç–æ–≤–æ –∫ –∑–∞–ø—É—Å–∫—É –≤ Telegram!** üöÄ
